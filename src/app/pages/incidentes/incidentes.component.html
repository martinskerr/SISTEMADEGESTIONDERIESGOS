<div style="padding: 20px; max-width: 1400px; margin: 0 auto;">
  
  <!-- Header -->
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
    <h2 style="margin: 0; color: #2c3e50; font-size: 28px;">GestiÃ³n de Incidentes</h2>
    <button 
      (click)="toggleFormulario()" 
      [style.background]="mostrarFormulario ? 'linear-gradient(135deg, #6c757d 0%, #495057 100%)' : 'linear-gradient(135deg, #28a745 0%, #20c997 100%)'"
      style="padding: 12px 24px; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 15px; font-weight: 600; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);">
      <span style="font-size: 18px; margin-right: 5px;">{{ mostrarFormulario ? 'âœ–ï¸' : '+' }}</span>
      {{ mostrarFormulario ? 'Cancelar' : 'Nuevo Incidente' }}
    </button>
  </div>

  <!-- Mensajes -->
  <div *ngIf="mensaje" style="background: #d4edda; color: #155724; padding: 15px; border-radius: 6px; margin-bottom: 15px; font-weight: 500;">
    âœ… {{ mensaje }}
  </div>

  <div *ngIf="error" style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 6px; margin-bottom: 15px; font-weight: 500;">
    âŒ {{ error }}
  </div>

  <!-- Formulario de nuevo incidente -->
  <div *ngIf="mostrarFormulario" style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 25px;">
    <h3 style="margin-top: 0; color: #2c3e50; margin-bottom: 20px;">ğŸ“ Nuevo Incidente</h3>
    
    <div style="margin-bottom: 15px;">
      <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #495057;">Riesgo Asociado *</label>
      <select 
        [(ngModel)]="nuevoIncidente.riesgo_id" 
        style="width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 14px;">
        <option *ngFor="let r of riesgos" [value]="r.riesgo_id">
          {{ r.titulo }} (Nivel: {{ r.nivel_riesgo }})
        </option>
      </select>
    </div>

    <div style="margin-bottom: 15px;">
      <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #495057;">DescripciÃ³n *</label>
      <textarea 
        [(ngModel)]="nuevoIncidente.descripcion"
        rows="4"
        placeholder="Describe el incidente ocurrido..."
        style="width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 14px; font-family: inherit; resize: vertical;">
      </textarea>
    </div>

    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #495057;">Estado</label>
      <select 
        [(ngModel)]="nuevoIncidente.estado"
        style="width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 14px;">
        <option *ngFor="let est of estados" [value]="est">{{ est }}</option>
      </select>
    </div>

    <div style="display: flex; gap: 10px;">
      <button 
        (click)="guardarIncidente()"
        style="padding: 12px 24px; background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; box-shadow: 0 2px 6px rgba(0, 123, 255, 0.3);">
        ğŸ’¾ Guardar
      </button>
      <button 
        (click)="cancelar()"
        style="padding: 12px 24px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
        Cancelar
      </button>
    </div>
  </div>

  <!-- Mensaje de carga -->
  <p *ngIf="cargando" style="padding: 15px; border-radius: 6px; text-align: center; background: #e3f2fd; color: #1976d2;">
    â³ Cargando incidentes...
  </p>

  <!-- Tabla de incidentes -->
  <div *ngIf="!cargando && incidentes.length > 0" style="background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); overflow-x: auto;">
    <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
      <thead style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
        <tr>
          <th style="padding: 14px 12px; text-align: left; font-weight: 600; font-size: 13px; white-space: nowrap;">ID</th>
          <th style="padding: 14px 12px; text-align: left; font-weight: 600; font-size: 13px; white-space: nowrap;">Riesgo Asociado</th>
          <th style="padding: 14px 12px; text-align: left; font-weight: 600; font-size: 13px; white-space: nowrap;">DescripciÃ³n</th>
          <th style="padding: 14px 12px; text-align: center; font-weight: 600; font-size: 13px; white-space: nowrap;">Estado</th>
          <th style="padding: 14px 12px; text-align: center; font-weight: 600; font-size: 13px; white-space: nowrap;">Fecha Incidente</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let inc of incidentes" style="border-bottom: 1px solid #e9ecef;">
          <td style="padding: 12px; font-weight: bold; color: #6c757d; font-size: 13px;">{{ inc.incidente_id }}</td>
          <td style="padding: 12px; font-weight: 600; color: #2c3e50; max-width: 250px;">{{ inc.riesgo_titulo }}</td>
          <td style="padding: 12px; max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: #6c757d;">{{ inc.descripcion }}</td>
          <td style="padding: 12px; text-align: center;">
            <span [style]="'padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 700; display: inline-block; background: ' + getEstadoBgColor(inc.estado) + '; color: ' + getEstadoTextColor(inc.estado)">
              {{ inc.estado }}
            </span>
          </td>
          <td style="padding: 12px; text-align: center; color: #495057;">{{ inc.fecha_incidente | date:'dd/MM/yyyy HH:mm' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Mensaje vacÃ­o -->
  <div *ngIf="!cargando && incidentes.length === 0" style="text-align: center; padding: 60px 20px; background: #f8f9fa; border-radius: 8px;">
    <p style="font-size: 18px; color: #6c757d; margin-bottom: 20px;">ğŸ“‹ No hay incidentes registrados.</p>
    <button 
      (click)="toggleFormulario()" 
      style="padding: 12px 24px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
      Registrar primer incidente
    </button>
  </div>

</div>
